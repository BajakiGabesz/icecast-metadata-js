export default class ISOBMFF{
    constructor() {

        this._moov = Uint8Array.from([0x00,0x00,0x00,0x20,0x66,0x74,0x79,0x70,0x69,0x73,0x6F,0x6D,0x00,0x00,0x02,0x00,0x69,0x73,0x6F,0x6D,0x69,0x73,0x6F,0x32,0x69,0x73,0x6F,0x36,0x6D,0x70,0x34,0x31,0x00,0x00,0x02,0x9F,0x6D,0x6F,0x6F,0x76,0x00,0x00,0x00,0x6C,0x6D,0x76,0x68,0x64,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xE8,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x01,0xA1,0x74,0x72,0x61,0x6B,0x00,0x00,0x00,0x5C,0x74,0x6B,0x68,0x64,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x3D,0x6D,0x64,0x69,0x61,0x00,0x00,0x00,0x20,0x6D,0x64,0x68,0x64,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xAC,0x44,0x00,0x00,0x00,0x00,0x55,0xC4,0x00,0x00,0x00,0x00,0x00,0x2D,0x68,0x64,0x6C,0x72,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x73,0x6F,0x75,0x6E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x53,0x6F,0x75,0x6E,0x64,0x48,0x61,0x6E,0x64,0x6C,0x65,0x72,0x00,0x00,0x00,0x00,0xE8,0x6D,0x69,0x6E,0x66,0x00,0x00,0x00,0x10,0x73,0x6D,0x68,0x64,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x24,0x64,0x69,0x6E,0x66,0x00,0x00,0x00,0x1C,0x64,0x72,0x65,0x66,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x0C,0x75,0x72,0x6C,0x20,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0xAC,0x73,0x74,0x62,0x6C,0x00,0x00,0x00,0x60,0x73,0x74,0x73,0x64,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x50,0x6D,0x70,0x34,0x61,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x10,0x00,0x00,0x00,0x00,0xAC,0x44,0x00,0x00,0x00,0x00,0x00,0x2C,0x65,0x73,0x64,0x73,0x00,0x00,0x00,0x00,0x03,0x80,0x80,0x80,0x1B,0x00,0x01,0x00,0x04,0x80,0x80,0x80,0x0D,0x6B,0x15,0x00,0x00,0x00,0x00,0x02,0xEE,0x00,0x00,0x00,0x00,0x00,0x06,0x80,0x80,0x80,0x01,0x02,0x00,0x00,0x00,0x10,0x73,0x74,0x74,0x73,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x73,0x74,0x73,0x63,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x14,0x73,0x74,0x73,0x7A,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x73,0x74,0x63,0x6F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x28,0x6D,0x76,0x65,0x78,0x00,0x00,0x00,0x20,0x74,0x72,0x65,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x62,0x75,0x64,0x74,0x61,0x00,0x00,0x00,0x5A,0x6D,0x65,0x74,0x61,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x21,0x68,0x64,0x6C,0x72,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x6D,0x64,0x69,0x72,0x61,0x70,0x70,0x6C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x2D,0x69,0x6C,0x73,0x74,0x00,0x00,0x00,0x25,0xA9,0x74,0x6F,0x6F,0x00,0x00,0x00,0x1D,0x64,0x61,0x74,0x61,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x4C,0x61,0x76,0x66,0x35,0x38,0x2E,0x32,0x39,0x2E,0x31,0x30,0x30])

       /*
        const moof = new boxParser.Box("moof");
        const traf = moof.add("traf");
        traf.add("tftd")
        const trun = moof.add("trun");
        trun.set("flags", 0x01);
*/

        /*
        ftyp file-type
          major_brand / compatible_brand -> must be something user agent supports
        moov
          must contain boxes / fields required by major_brand / compatible_brand
          entry_count in stts, stsc, and stco are set to 0
          mvex (movie extends) -> required
        styp (segment type)
          optional
        moof
          must conform to requirements for major_brand / compatible_brand
          traf (track fragment box) -> required
            tftd (track fragment decode time box) -> required
            base-data-offset-present - (must be set to false)
          trun (track fragment run) -> required
            data-offset-present (must be set to true)
        mdat
        */
    }

    get moov() {
        return this._moov;
    }

    getMoof() {
        return Uint8Array.from([0x00,0x00,0x01,0x0C,0x6D,0x6F,0x6F,0x66,0x00,0x00,0x00,0x10,0x6D,0x66,0x68,0x64,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0xF4,0x74,0x72,0x61,0x66,0x00,0x00,0x00,0x24,0x74,0x66,0x68,0x64,0x00,0x00,0x00,0x39,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0xBF,0x00,0x00,0x04,0x80,0x00,0x00,0x02,0x72,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x14,0x74,0x66,0x64,0x74,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xB4,0x74,0x72,0x75,0x6E,0x00,0x00,0x02,0x01,0x00,0x00,0x00,0x28,0x00,0x00,0x01,0x14,0x00,0x00,0x02,0x72,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x72,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x72,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73,0x00,0x00,0x02,0x73])
    }

    wrap(data) {
        const moof = this.getMoof();

        const length = new Uint8Array(4);
        new DataView(length.buffer).setUint32(0, data.length, false);

        const mdat = Uint8Array.from([0x6D, 0x64, 0x61, 0x74]);
        const wrapped = Uint8Array.from([...moof, ...length, ...mdat, ...data])

        return wrapped;
    }

}